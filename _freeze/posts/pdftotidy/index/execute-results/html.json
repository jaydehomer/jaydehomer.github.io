{
  "hash": "56b2df7365f3d16e9b4c861df46c00f4",
  "result": {
    "markdown": "---\ntitle: \"From a PD(woo)F to Text Frequencies\"\nauthor: \"Jayde Homer\"\ndate: \"2023-11-10\"\ncategories: [fun]\nimage: \"../../pics/IMG_9787.jpeg\"\n---\n\n\n\nA brilliant grad school [friend of mine](https://www.amanda-j-wright.com/) recently asked if I knew anything about text extraction. From there she unknowingly opened a can of worms for me! \n\nIn this blog post, I'd like to show you how you can analyze text from a PDF using the [package](https://cran.r-project.org/web/packages/pdftools/index.html) `pdftools`. This process is helpful for many types of analyses, but we'll use it to do some basic text frequency analyses. \n\nFirst things first, we need an article. I chose one that aligns with something I'm particularly passionate about: force-free dog training. If you'd like to learn more about how to use science-backed training methods that build a positive relationship between you and your dog, check out [Zak George's channel](https://www.youtube.com/channel/UCZzFRKsgVMhGTxffpzgTJlQ) for starters. \n\nHere's the [document](https://animalkind.ca/wp-content/uploads/dog-training-methods-review.pdf) we're going to be using.\n\n## pdftools for text extraction\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(pdftools)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nUsing poppler version 23.08.0\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidytext)\nlibrary(knitr)\n\n# tell R the name of your pdf file\ndogs_pdf <- \"dog-training-methods-review.pdf\"\n```\n:::\n\nThere a few handy functions that we can play around with. Here, I'm using `pdf_text()` to convert all text on the pages of the document to a large string. Using `cat()` we can take a look at one of those pages. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndogs_text <- pdf_text(dogs_pdf)\ncat(dogs_text[1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReview of dog training methods                                                   December 2018\n\n                                         March 2023\n\n   Prepared for the British Columbia Society for the Prevention of Cruelty to Animals Author:\n                                  I.J. Makowska, M.Sc., Ph.D.\n                                Updated by: C.M. Cavalli, Ph.D.\n```\n:::\n\n```{.r .cell-code}\ncat(dogs_text[69])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Review of dog training methods                                                                                                                               March 2023\n\n                                                                                Dog Welfare (continued)\n               Study              Study type     Sample size             Task                                                         Outcomes\nTodd, 2018                   Review             N/A            N/A                      Barriers to the use of humane training methods:\n                                                                                         Disagreeing positions of animal behaviour and veterinary organizations and dog trainers may contribute\n                                                                                        to the idea that there is a lack of consensus on appropriate methods.\n                                                                                          Lack of knowledge of the welfare risks\n                                                                                          Lack of theoretical and practical knowledge of dog training\n                                                                                          Poor quality of the information available to guardians\n                                                                                          Lack of regulations for dog trainers\n\n\nWiliams & Blackwell, 2019    Survey             630            Various                  Predictors of current use and reported future intention of using positive reinforcement methods:\n                                                                                         Perceived efficacy of the method\n                                                                                         Guardians perceived ability to effectively implement the method\n\nWoodward et al., 2021        Survey             2154           Various                  At 16 weeks\n                                                guardians in                             99.7% of the guardians reported the intention to use positive reinforcement and/or negative\n                                                the UK or                               punishment\n                                                Ireland with                             84.1% intended to use positive punishment and/or negative reinforcement\n                                                puppies <16                              15.6% could be classified as reward only\n                                                weeks                                    12.9% could be classified as using a mix of reward and aversive-based training\n\n                                                976 of them                             At 9 months\n                                                completed a                              99.7% of the guardians reported using positive reinforcement and/or negative punishment\n                                                follow-up                                74.2% used positive punishment and/or negative reinforcement\n                                                survey at 9                              25.8% could be classified as reward only\n                                                months.                                  29.2% could be classified as using a mix of reward and aversive-based training\n\n                                                                                        Guardian factors that increased the likelihood of using both reward and aversive-based training at 9\n                                                                                        months:\n                                                                                         Males\n                                                                                         Age > 55 years\n                                                                                         Not having dog related employment\n                                                                                         Not having attended a training class in the 2 months before completing the questionnaire\n\n      Prepared for the BC SPCA by I.J. Makowska & updated by C.M. Cavalli                                                 69\n```\n:::\n:::\n\n\nIt's a bit messy. So instead, we can use `pdf_data()` to convert the text to a data frame. The first line, which I commented out, returns data frames for each page including information about the location of text on the page and the content of the text (i.e., the words). Here's an example of the first page. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#pdf_data(dogs_pdf)\npdf_data(dogs_pdf)[[1]] %>% \n  head(5) %>% \n  kable()\n```\n\n::: {.cell-output-display}\n| width| height|   x|  y|space |text     |\n|-----:|------:|---:|--:|:-----|:--------|\n|    31|     11|  72| 32|TRUE  |Review   |\n|     9|     11| 106| 32|TRUE  |of       |\n|    16|     11| 117| 32|TRUE  |dog      |\n|    35|     11| 137| 32|TRUE  |training |\n|    38|     11| 174| 32|FALSE |methods  |\n:::\n:::\n\n\nWe can use `dplyr` to aggregate the data, or bind all of the rows in each of our 69 tibbles together into one big tibble. Now you see we have 25,052 rows. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndogs_text <- pdf_data(dogs_pdf) %>% \n  bind_rows() %>% \n  select(text) # I only want the column containing the words\n\nstr(dogs_text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [25,052 × 1] (S3: tbl_df/tbl/data.frame)\n $ text: chr [1:25052] \"Review\" \"of\" \"dog\" \"training\" ...\n```\n:::\n:::\n\n## Tidy text\n\nNow that we have our data, we need to tidy it up! Literally. Check out [Text Mining with R: A Tidy Approach](https://www.tidytextmining.com/tidytext) if you want to dig deeper into text mining. \n\nOur data is already unnested, meaning each word is in a row. We do not have sentences. This is one-token-per-document-per-row. A \"token\" is a meaningful unit of text. Sometimes the unit of text you'd like to analyze is a sentence or phrase, but more commonly, you'll want your tokens to be words. \n\nOne thing we will want to do is remove punctuation from our tokens. This could cause trouble when we want to aggregate by tokens (e.g., get word counts). So, while we already mostly have unnested tokens, the `unnest_tokens` function will also strip punctuation and convert tokens to lowercase. We'll also take this opportunity to remove stop words (the little ones that turn out to be most frequent in spoken and written language, such as \"the,\" \"and,\" \"to\"). Just what we needed!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"stop_words\")\ndogs_tidy <- dogs_text %>% \n  unnest_tokens(input = text, output = word) %>% \n  anti_join(stop_words)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining with `by = join_by(word)`\n```\n:::\n\n```{.r .cell-code}\ndogs_tidy %>% \n  head(5) %>% \n  kable()\n```\n\n::: {.cell-output-display}\n|word     |\n|:--------|\n|review   |\n|dog      |\n|training |\n|methods  |\n|december |\n:::\n:::\n\n\n## Question time\n\nI know you're dying to know what words these researchers used most in their report of dog training methods. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndogs_tidy %>% \n  count(word, sort = TRUE) %>% \n  head(10) %>% \n  kable()\n```\n\n::: {.cell-output-display}\n|word      |   n|\n|:---------|---:|\n|training  | 388|\n|dogs      | 387|\n|dog       | 274|\n|methods   | 248|\n|collar    | 219|\n|collars   | 208|\n|shock     | 176|\n|based     | 171|\n|aversive  | 136|\n|guardians | 134|\n:::\n:::\n\n\nColor me shocked at this list! Seems like these researchers have a lot to say about dog training methods, shock collars, guardians, and aversive. \n\nNow there are so many things you can do with this tidy text. It's now ready to do cross-text comparison, plot frequencies or proportions, and dig deeper to answer your text-based questions. \n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}